# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: capital-agent-route # Name for this routing rule
  # Ensure this namespace matches the Gateway and InferencePool
  namespace: default # Or <YOUR_APP_NAMESPACE>
spec:
  # Link this route to the Gateway created earlier
  parentRefs:
    - name: capital-agent-gateway # Must match the metadata.name of your Gateway
      # Optional: If your Gateway has multiple listeners, specify which one
      # sectionName: http
  # Optional: Define hostnames if you want to route based on domain name
  # hostnames:
  # - "capital-agent.your-domain.com"
  rules:
    # Define rules for matching incoming requests
    - matches:
        # This rule matches any request path starting with "/" (effectively all traffic)
        - path:
            type: PathPrefix
            value: /
      # Define where to send the matched traffic
      backendRefs:
        # This points the route specifically to the InferencePool resource
        - group: gateway.gke.io # GKE-specific group for InferencePool
          kind: InferencePool
          name: capital-agent-pool # Must match the metadata.name of your InferencePool
          # Note: Unlike routing to a standard Service, you don't specify a port here.
          # The InferencePool definition already includes the targetPortNumber.
